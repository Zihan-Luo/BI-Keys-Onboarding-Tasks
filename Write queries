--Q1. a.Display a list of all property names and their property idâ€™s for Owner Id: 1426. 

 SELECT [Name],
        [PropertyId]
  	FROM [Property] P
  	INNER JOIN [OwnerProperty] O on P.Id = O.PropertyId
  	WHERE OwnerId = 1426 
  
--Q1. b.Display the current home value for each property in question a).

SELECT P.Name PropertyName,
       P.ID PropertyID,
       PHV.Value CurrentHomeValue
	   FROM OwnerProperty OP
	   INNER JOIN Property p ON OP.PropertyID =P.ID
	   INNER JOIN PropertyHomeValue PHV ON P.ID = PHV.PropertyId
       WHERE OP.OwnerId = 1426 and PHV.IsActive = 1 
       ORDER BY P.Name
  
--Q1. c.For each property in question a), return the following:                                                                      
--	i.Using rental payment amount, rental payment frequency, tenant start date and tenant end date to write a query that returns the sum of all payments from start date to end date. 
--	ii.Display the yield.
    SELECT P.Name PropertyName,
	   P.ID PropertyID,
	   CASE 
		   WHEN TRT.Name ='Weekly' THEN (DATEDIFF(wk, TP.StartDate, TP.EndDate)*PRP.Amount)
		   WHEN TRT.Name = 'Fortnightly' THEN ((DATEDIFF(wk, TP.StartDate, TP.EndDate)/2)*PRP.Amount)
		   ELSE (DATEDIFF(m, TP.StartDate, TP.EndDate)*PRP.Amount)
	   END AS SumOfPayments,
	   TRT.Name RentalPaymentFrequency,
	   PRP.Amount RentalPaymentAmount,
	   ((CASE 
		   WHEN TRT.Name ='Weekly' THEN (DATEDIFF(wk, TP.StartDate, TP.EndDate)*PRP.Amount)
		   WHEN TRT.Name = 'Fortnightly' THEN ((DATEDIFF(wk, TP.StartDate, TP.EndDate)/2)*PRP.Amount)
		   ELSE (DATEDIFF(m, TP.StartDate, TP.EndDate)*PRP.Amount)
		   END
	   )/PHV.Value)*100 Yield,
	   TP.StartDate TenantStartDate,
	   TP.EndDate TenantEndDate
	   FROM Property P
		    INNER JOIN OwnerProperty OP ON P.ID = OP.PropertyID
			INNER JOIN PropertyRentalPayment PRP ON P.ID = PRP.PropertyID
			INNER JOIN TargetRentType TRT ON PRP.FrequencyType = TRT.ID
			INNER JOIN TenantProperty TP ON P.ID = TP.PropertyID
			INNER JOIN PropertyHomeValue PHV ON P.ID = PHV.PropertyID
	   WHERE OP.OwnerId = 1426
  
--1. d.Display all the jobs available
SELECT J.[Id]
       ,[ProviderId]
       ,J.[PropertyId]
       ,[OwnerId]
       ,[PaymentAmount]
       ,[JobStartDate]
       ,[JobEndDate]
       ,[JobDescription]
       ,[JobStatusId]
       ,[UpdatedBy]
       ,[CreatedOn]
       ,[CreatedBy]
       ,[UpdatedOn]
       ,[MaxBudget]
       ,[PercentDone]
       ,[Note]
       ,[AcceptedQuote]
       ,[OwnerUpdate]
       ,[ServiceUpdate]
       ,[JobRequestId]
       FROM [Keys].[dbo].[Job] J
       INNER JOIN JobMedia JM on J.Id = JM.JobId
       WHERE JM.IsActive = 1
  
--1. e.Display all property names, current tenants first and last names and rental payments per week/ fortnight/month for the properties in question a).  
    SELECT P.Name PropetyName,
	   PS.FirstName TenantFirstName,
	   PS.LastName TenantLastName,
	   TP.PaymentAmount RentalAmount,
	   TPF.Name PaymentFrequency
	   FROM OwnerProperty OP inner join Property P on OP.PropertyId = P.Id
			INNER JOIN TenantProperty TP on P.Id = TP.PropertyId
			INNER JOIN PropertyRentalPayment PRP on TP.PropertyId = PRP.PropertyId
			INNER JOIN TenantPaymentFrequencies TPF on PRP.FrequencyType = TPF.Id
			INNER JOIN Person PS on PS.Id = TP.TenantId
	   WHERE OP.OwnerId = 1426

--2. Use Report Builder or Visual Studio (SSRS) to develop the following report.
	SELECT P.Id PropertyId,
	   P.AddressId, 
	   P.Name PropertyName, 
	   P.Bedroom, 
	   P.Bathroom, 
	   A.number AddressNumber, 
	   A.street Address, 
	   PE.Amount, 
	   PRT.Amount RentalPayment,
	   CASE 
		   WHEN TPF.Name ='Weekly' Then 'Week'
		   WHEN TPF.Name ='Fortnightly' Then 'Fortnight'
		   ELSE 'Month'
	   END PaymentFrequencies,
	   OP.OwnerId, 
	   PS.FirstName OwnerFirstName, 
	   PS.LastName OwnerLastName,
	   P.CreatedOn,
	   PE.Description
	FROM Property P
	   INNER JOIN Address A ON P.addressid = A.addressid
	   INNER JOIN PropertyExpense PE on P.Id = PE.PropertyId
	   INNER JOIN OwnerProperty OP on P.Id = OP.PropertyId
	   INNER JOIN Person PS on OP.OwnerId = PS.Id
 	   INNER JOIN PropertyRentalPayment PRT on P.Id = PRT.PropertyId
	   INNER JOIN TenantPaymentFrequencies TPF on PRT.FrequencyType = TPF.Id
        WHERE P.name = 'Property A'  

